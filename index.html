<!DOCTYPE html>
<html>
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <script src="https://telegram.org/js/telegram-web-app.js"></script>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }
        
        body {
            background: #f5f5f5;
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, sans-serif;
            min-height: 100vh;
            padding: 16px;
        }
        
        .header {
            background: white;
            border-radius: 16px;
            padding: 20px;
            margin-bottom: 20px;
            box-shadow: 0 4px 12px rgba(0,0,0,0.05);
            text-align: center;
        }
        
        .balance {
            font-size: 32px;
            font-weight: bold;
            color: #2481cc;
            margin: 10px 0;
        }
        
        .balance-label {
            color: #666;
            font-size: 14px;
        }
        
        .menu-grid {
            display: grid;
            grid-template-columns: repeat(3, 1fr);
            gap: 12px;
            margin: 20px 0;
        }
        
        .menu-item {
            background: white;
            border-radius: 16px;
            padding: 20px 10px;
            text-align: center;
            box-shadow: 0 4px 12px rgba(0,0,0,0.05);
            cursor: pointer;
            transition: transform 0.2s;
        }
        
        .menu-item:hover {
            transform: translateY(-2px);
        }
        
        .menu-item:active {
            transform: scale(0.95);
        }
        
        .menu-icon {
            font-size: 32px;
            margin-bottom: 8px;
        }
        
        .menu-title {
            font-weight: 500;
            color: #333;
        }
        
        .bonus-card {
            background: white;
            border-radius: 20px;
            padding: 30px;
            text-align: center;
            box-shadow: 0 4px 12px rgba(0,0,0,0.05);
        }
        
        .bonus-icon {
            font-size: 64px;
            margin: 20px;
        }
        
        .bonus-button {
            background: #4CAF50;
            color: white;
            border: none;
            padding: 20px 40px;
            font-size: 24px;
            font-weight: bold;
            border-radius: 16px;
            cursor: pointer;
            width: 100%;
            margin: 20px 0;
            transition: background 0.2s;
        }
        
        .bonus-button:active {
            transform: scale(0.98);
        }
        
        .bonus-button:disabled {
            background: #ccc;
            cursor: not-allowed;
        }
        
        .back-button {
            background: #f5f5f5;
            color: #666;
            border: none;
            padding: 15px 30px;
            border-radius: 30px;
            font-size: 16px;
            cursor: pointer;
            margin: 20px 0;
            width: 100%;
        }
        
        .stats-card {
            background: white;
            border-radius: 20px;
            padding: 20px;
            margin: 10px 0;
            box-shadow: 0 4px 12px rgba(0,0,0,0.05);
        }
        
        .stat-row {
            display: flex;
            justify-content: space-between;
            padding: 12px 0;
            border-bottom: 1px solid #eee;
        }
        
        .stat-row:last-child {
            border-bottom: none;
        }
        
        .stat-label {
            color: #666;
        }
        
        .stat-value {
            font-weight: bold;
            color: #333;
        }
        
        .loading {
            text-align: center;
            padding: 50px;
        }
        
        .loading-spinner {
            display: inline-block;
            width: 40px;
            height: 40px;
            border: 4px solid #f3f3f3;
            border-top: 4px solid #2481cc;
            border-radius: 50%;
            animation: spin 1s linear infinite;
        }
        
        @keyframes spin {
            0% { transform: rotate(0deg); }
            100% { transform: rotate(360deg); }
        }
        
        .hidden {
            display: none;
        }
        
        .message {
            padding: 15px;
            border-radius: 12px;
            margin: 10px 0;
            text-align: center;
        }
        
        .message.success {
            background: #d4edda;
            color: #155724;
        }
        
        .message.error {
            background: #f8d7da;
            color: #721c24;
        }
        
        .message.info {
            background: #d1ecf1;
            color: #0c5460;
        }
    </style>
</head>
<body>
    <div id="app">
        <!-- –≠–∫—Ä–∞–Ω –∑–∞–≥—Ä—É–∑–∫–∏ -->
        <div id="loadingScreen" class="loading">
            <div class="loading-spinner"></div>
            <p>–ó–∞–≥—Ä—É–∑–∫–∞ –¥–∞–Ω–Ω—ã—Ö...</p>
        </div>

        <!-- –ì–ª–∞–≤–Ω–æ–µ –º–µ–Ω—é -->
        <div id="mainMenu" class="hidden">
            <div class="header">
                <div class="balance-label">–í–∞—à –±–∞–ª–∞–Ω—Å</div>
                <div class="balance" id="balanceDisplay">0</div>
            </div>
            
            <div class="menu-grid">
                <div class="menu-item" onclick="showBonus()">
                    <div class="menu-icon">üéÅ</div>
                    <div class="menu-title">–ë–æ–Ω—É—Å</div>
                </div>
                <div class="menu-item" onclick="showGames()">
                    <div class="menu-icon">üéÆ</div>
                    <div class="menu-title">–ò–≥—Ä—ã</div>
                </div>
                <div class="menu-item" onclick="showSettings()">
                    <div class="menu-icon">‚öôÔ∏è</div>
                    <div class="menu-title">–ù–∞—Å—Ç—Ä–æ–π–∫–∏</div>
                </div>
            </div>
        </div>

        <!-- –≠–∫—Ä–∞–Ω –±–æ–Ω—É—Å–∞ -->
        <div id="bonusScreen" class="hidden">
            <div class="header">
                <div class="balance-label">–í–∞—à –±–∞–ª–∞–Ω—Å</div>
                <div class="balance" id="bonusBalanceDisplay">0</div>
            </div>

            <div class="bonus-card">
                <div class="bonus-icon">üéÅ</div>
                <h2>–ï–∂–µ–¥–Ω–µ–≤–Ω—ã–π –±–æ–Ω—É—Å</h2>
                
                <div id="bonusMessage" class="message info hidden"></div>
                
                <button class="bonus-button" id="claimBonusBtn" onclick="claimBonus()">
                    –ó–∞–±—Ä–∞—Ç—å –±–æ–Ω—É—Å
                </button>
                
                <div id="nextBonusTime" class="stat-row">
                    <span class="stat-label">–°—Ç–∞—Ç—É—Å:</span>
                    <span class="stat-value" id="bonusStatus">–ü—Ä–æ–≤–µ—Ä–∫–∞...</span>
                </div>
            </div>

            <button class="back-button" onclick="showMainMenu()">‚Üê –ù–∞–∑–∞–¥ –≤ –º–µ–Ω—é</button>
        </div>

        <!-- –≠–∫—Ä–∞–Ω –∏–≥—Ä -->
        <div id="gamesScreen" class="hidden">
            <div class="header">
                <div class="balance-label">–í–∞—à –±–∞–ª–∞–Ω—Å</div>
                <div class="balance" id="gamesBalanceDisplay">0</div>
            </div>

            <div class="stats-card" style="text-align: center; padding: 40px;">
                <div style="font-size: 48px; margin-bottom: 20px;">üéÆ</div>
                <h3>–ò–≥—Ä—ã –≤ —Ä–∞–∑—Ä–∞–±–æ—Ç–∫–µ</h3>
                <p style="color: #666; margin-top: 10px;">–°–∫–æ—Ä–æ –∑–¥–µ—Å—å –ø–æ—è–≤—è—Ç—Å—è –∏–≥—Ä—ã</p>
            </div>

            <button class="back-button" onclick="showMainMenu()">‚Üê –ù–∞–∑–∞–¥ –≤ –º–µ–Ω—é</button>
        </div>

        <!-- –≠–∫—Ä–∞–Ω –Ω–∞—Å—Ç—Ä–æ–µ–∫ -->
        <div id="settingsScreen" class="hidden">
            <div class="header">
                <div class="balance-label">–í–∞—à –±–∞–ª–∞–Ω—Å</div>
                <div class="balance" id="settingsBalanceDisplay">0</div>
            </div>

            <div class="stats-card">
                <div class="stat-row">
                    <span class="stat-label">–í–∞—à ID –≤ —Å–∏—Å—Ç–µ–º–µ:</span>
                    <span class="stat-value" id="userSystemId">-</span>
                </div>
                <div class="stat-row">
                    <span class="stat-label">–ù–∏–∫–Ω–µ–π–º:</span>
                    <span class="stat-value" id="userUsername">-</span>
                </div>
                <div class="stat-row">
                    <span class="stat-label">–î–∞—Ç–∞ —Ä–µ–≥–∏—Å—Ç—Ä–∞—Ü–∏–∏:</span>
                    <span class="stat-value" id="userJoinDate">-</span>
                </div>
                <div class="stat-row">
                    <span class="stat-label">–°—ã–≥—Ä–∞–Ω–æ –∏–≥—Ä:</span>
                    <span class="stat-value" id="userGamesPlayed">0</span>
                </div>
                <div class="stat-row">
                    <span class="stat-label">–í—Å–µ–≥–æ –∑–∞—Ä–∞–±–æ—Ç–∞–Ω–æ:</span>
                    <span class="stat-value" id="userTotalEarned">0</span>
                </div>
            </div>

            <button class="back-button" onclick="showMainMenu()">‚Üê –ù–∞–∑–∞–¥ –≤ –º–µ–Ω—é</button>
        </div>
    </div>

    <script>
        // –ò–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏—è Telegram
        const tg = window.Telegram.WebApp;
        tg.expand();
        tg.ready();

        // –î–∞–Ω–Ω—ã–µ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è
        let userData = null;
        let balance = 0;
        let systemId = '';

        // –ü—Ä–∏ –∑–∞–≥—Ä—É–∑–∫–µ —Å—Ç—Ä–∞–Ω–∏—Ü—ã
        window.onload = function() {
            loadUserData();
        };

        // –ó–∞–≥—Ä—É–∑–∫–∞ –¥–∞–Ω–Ω—ã—Ö –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è –∏–∑ –±–æ—Ç–∞
        function loadUserData() {
            try {
                const user = tg.initDataUnsafe?.user;
                if (!user) {
                    showError('–ü–æ–∂–∞–ª—É–π—Å—Ç–∞, –Ω–∞–∂–º–∏—Ç–µ "–†–∞–∑—Ä–µ—à–∏—Ç—å" –≤ Telegram');
                    return;
                }

                userData = user;
                
                // –ó–∞–ø—Ä–∞—à–∏–≤–∞–µ–º –¥–∞–Ω–Ω—ã–µ —É –±–æ—Ç–∞
                tg.sendData(JSON.stringify({
                    action: 'get_user_data',
                    user_id: user.id
                }));

                // –¢–∞–π–º–∞—É—Ç –Ω–∞ —Å–ª—É—á–∞–π –µ—Å–ª–∏ –±–æ—Ç –Ω–µ –æ—Ç–≤–µ—á–∞–µ—Ç
                setTimeout(() => {
                    if (document.getElementById('loadingScreen').classList.contains('hidden') === false) {
                        showMainMenu();
                    }
                }, 3000);
                
            } catch (error) {
                console.error('Error:', error);
                showError('–û—à–∏–±–∫–∞ –∑–∞–≥—Ä—É–∑–∫–∏ –¥–∞–Ω–Ω—ã—Ö');
            }
        }

        // –û–±–Ω–æ–≤–ª–µ–Ω–∏–µ –±–∞–ª–∞–Ω—Å–∞ –Ω–∞ –≤—Å–µ—Ö —ç–∫—Ä–∞–Ω–∞—Ö
        function updateBalanceDisplay(newBalance) {
            balance = newBalance;
            document.getElementById('balanceDisplay').textContent = balance;
            document.getElementById('bonusBalanceDisplay').textContent = balance;
            document.getElementById('gamesBalanceDisplay').textContent = balance;
            document.getElementById('settingsBalanceDisplay').textContent = balance;
        }

        // –ü–æ–∫–∞–∑–∞—Ç—å –≥–ª–∞–≤–Ω–æ–µ –º–µ–Ω—é
        function showMainMenu() {
            hideAllScreens();
            document.getElementById('loadingScreen').classList.add('hidden');
            document.getElementById('mainMenu').classList.remove('hidden');
        }

        // –ü–æ–∫–∞–∑–∞—Ç—å —ç–∫—Ä–∞–Ω –±–æ–Ω—É—Å–∞
        function showBonus() {
            hideAllScreens();
            document.getElementById('bonusScreen').classList.remove('hidden');
            
            document.getElementById('claimBonusBtn').disabled = true;
            document.getElementById('bonusStatus').textContent = '–ü—Ä–æ–≤–µ—Ä–∫–∞...';
            
            tg.sendData(JSON.stringify({
                action: 'check_bonus',
                user_id: userData.id
            }));
        }

        // –ü–æ–∫–∞–∑–∞—Ç—å —ç–∫—Ä–∞–Ω –∏–≥—Ä
        function showGames() {
            hideAllScreens();
            document.getElementById('gamesScreen').classList.remove('hidden');
        }

        // –ü–æ–∫–∞–∑–∞—Ç—å —ç–∫—Ä–∞–Ω –Ω–∞—Å—Ç—Ä–æ–µ–∫
        function showSettings() {
            hideAllScreens();
            document.getElementById('settingsScreen').classList.remove('hidden');
        }

        // –ó–∞–±—Ä–∞—Ç—å –±–æ–Ω—É—Å
        function claimBonus() {
            const btn = document.getElementById('claimBonusBtn');
            btn.disabled = true;
            btn.textContent = '–ó–∞–≥—Ä—É–∑–∫–∞...';
            
            tg.sendData(JSON.stringify({
                action: 'claim_bonus',
                user_id: userData.id
            }));
        }

        // –û–±–Ω–æ–≤–∏—Ç—å –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏—é –æ –±–æ–Ω—É—Å–µ
        function updateBonusInfo(canClaim) {
            const btn = document.getElementById('claimBonusBtn');
            const status = document.getElementById('bonusStatus');
            
            if (canClaim) {
                btn.disabled = false;
                btn.textContent = '–ó–∞–±—Ä–∞—Ç—å –±–æ–Ω—É—Å';
                status.textContent = '–î–æ—Å—Ç—É–ø–µ–Ω';
                status.style.color = '#4CAF50';
                document.getElementById('bonusMessage').classList.add('hidden');
            } else {
                btn.disabled = true;
                btn.textContent = '–ë–æ–Ω—É—Å —É–∂–µ –ø–æ–ª—É—á–µ–Ω';
                status.textContent = '–£–∂–µ –ø–æ–ª—É—á–µ–Ω —Å–µ–≥–æ–¥–Ω—è';
                status.style.color = '#ff4444';
                
                const msgDiv = document.getElementById('bonusMessage');
                msgDiv.classList.remove('hidden');
                msgDiv.classList.add('info');
                msgDiv.textContent = '–í—ã —É–∂–µ –ø–æ–ª—É—á–∞–ª–∏ –±–æ–Ω—É—Å —Å–µ–≥–æ–¥–Ω—è. –°–ª–µ–¥—É—é—â–∏–π –±–æ–Ω—É—Å ‚Äî –∑–∞–≤—Ç—Ä–∞!';
            }
        }

        // –û–±–Ω–æ–≤–∏—Ç—å –¥–∞–Ω–Ω—ã–µ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è –∏–∑ –±–æ—Ç–∞
        function updateUserData(data) {
            if (data.balance !== undefined) {
                updateBalanceDisplay(data.balance);
            }
            if (data.system_id) {
                systemId = data.system_id;
                document.getElementById('userSystemId').textContent = data.system_id;
            }
            if (data.username) {
                document.getElementById('userUsername').textContent = '@' + data.username;
            }
            if (data.join_date) {
                document.getElementById('userJoinDate').textContent = data.join_date;
            }
            if (data.games_played !== undefined) {
                document.getElementById('userGamesPlayed').textContent = data.games_played;
            }
            if (data.total_earned !== undefined) {
                document.getElementById('userTotalEarned').textContent = data.total_earned;
            }
        }

        // –ü–æ–∫–∞–∑–∞—Ç—å –æ—à–∏–±–∫—É
        function showError(message) {
            hideAllScreens();
            const errorDiv = document.createElement('div');
            errorDiv.style.position = 'fixed';
            errorDiv.style.top = '50%';
            errorDiv.style.left = '50%';
            errorDiv.style.transform = 'translate(-50%, -50%)';
            errorDiv.style.padding = '20px';
            errorDiv.style.background = '#f8d7da';
            errorDiv.style.color = '#721c24';
            errorDiv.style.borderRadius = '12px';
            errorDiv.style.textAlign = 'center';
            errorDiv.style.maxWidth = '300px';
            errorDiv.textContent = message;
            document.body.appendChild(errorDiv);
        }

        // –°–∫—Ä—ã—Ç—å –≤—Å–µ —ç–∫—Ä–∞–Ω—ã
        function hideAllScreens() {
            document.getElementById('loadingScreen').classList.add('hidden');
            document.getElementById('mainMenu').classList.add('hidden');
            document.getElementById('bonusScreen').classList.add('hidden');
            document.getElementById('gamesScreen').classList.add('hidden');
            document.getElementById('settingsScreen').classList.add('hidden');
        }

        // –û–±—Ä–∞–±–æ—Ç–∫–∞ –¥–∞–Ω–Ω—ã—Ö –æ—Ç –±–æ—Ç–∞
        tg.onEvent('sendData', function(data) {
            try {
                const response = JSON.parse(data);
                console.log('Response from bot:', response);
                
                if (response.action === 'user_data') {
                    // –î–∞–Ω–Ω—ã–µ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è –∏–∑ –±–æ—Ç–∞
                    updateUserData(response.data);
                    showMainMenu();
                }
                else if (response.action === 'bonus_info') {
                    // –ò–Ω—Ñ–æ—Ä–º–∞—Ü–∏—è –æ –±–æ–Ω—É—Å–µ
                    updateBonusInfo(response.can_claim);
                }
                else if (response.action === 'bonus_claimed') {
                    // –ë–æ–Ω—É—Å —É—Å–ø–µ—à–Ω–æ –ø–æ–ª—É—á–µ–Ω
                    updateBalanceDisplay(response.new_balance);
                    
                    const msgDiv = document.getElementById('bonusMessage');
                    msgDiv.classList.remove('hidden');
                    msgDiv.classList.add('success');
                    msgDiv.textContent = `üéâ –í—ã –ø–æ–ª—É—á–∏–ª–∏ –±–æ–Ω—É—Å!`;
                    
                    updateBonusInfo(false);
                }
                else if (response.action === 'bonus_error') {
                    // –û—à–∏–±–∫–∞ –ø–æ–ª—É—á–µ–Ω–∏—è –±–æ–Ω—É—Å–∞
                    const msgDiv = document.getElementById('bonusMessage');
                    msgDiv.classList.remove('hidden');
                    msgDiv.classList.add('error');
                    msgDiv.textContent = response.message;
                    
                    document.getElementById('claimBonusBtn').disabled = false;
                    document.getElementById('claimBonusBtn').textContent = '–ó–∞–±—Ä–∞—Ç—å –±–æ–Ω—É—Å';
                }
            } catch (e) {
                console.error('Error parsing response:', e);
            }
        });
    </script>
</body>
</html>
